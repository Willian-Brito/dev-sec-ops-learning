name: Continuous Integration

on:
  push:
    branches: [ main ]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Build
              run: echo "Building the project..."

    unit-test:
        runs-on: ubuntu-latest
        needs: build
        steps:
            - name: Test
              run: echo "Running tests..."

    deploy:
        runs-on: ubuntu-latest
        needs: unit-test
        steps:
            - name: Deploy
              run: echo "Deploying the project..."

    sca:
        # needs: versioning
        runs-on: ubuntu-latest
        name: SCA - Software Composition Analysis
        steps:
            - name: Checkout Code
              uses: actions/checkout@v4
            
            - name: Setup Java (required for Dependency-Check)
              uses: actions/setup-java@v3
              with:
                distribution: 'temurin'
                java-version: '17'

            - name: Run OWASP Dependency-Check
            
              uses: dependency-check/Dependency-Check_Action@main
              id: depcheck
              with:
                project: '${{ github.repository }}'
                path: '.'
                format: 'HTML'
                out: 'dependency-reports'
                args: |              
                  --scan ./src/api
              env:
                JAVA_HOME: /opt/jdk

            - name: Upload vulnerability report
              if: always()
              uses: actions/upload-artifact@v4
              with:
                name: dependency-check-report
                path: dependency-reports/

    sast:
        # needs: versioning
        name: SAST
        runs-on: ubuntu-latest
        permissions:
            security-events: write
            packages: read
            actions: read
            contents: read

        steps:
        - uses: actions/checkout@v4

        - uses: github/codeql-action/init@v3
          with:
            languages: csharp
            build-mode: none

        - uses: github/codeql-action/analyze@v3
          with:
            category: "/language:csharp"
        if: github.ref != 'refs/heads/main'

